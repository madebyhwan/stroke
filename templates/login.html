{% extends 'base.html' %}

{% block title %}로그인 - 뇌졸중 관리 시스템{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center -mt-20">
    <div class="w-full max-w-md fade-in">
        <!-- 로고 및 제목 -->
        <div class="text-center mb-8">

            <h1 class="text-3xl font-bold text-gray-800 mb-2">뇌졸중 관리 시스템</h1>
        </div>

        <!-- 로그인 폼 -->
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">로그인</h2>
            
            <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label for="userId" class="block text-sm font-medium text-gray-700 mb-2">
                        아이디
                    </label>
                    <input 
                        type="text" 
                        id="userId" 
                        name="id" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent transition"
                        placeholder="아이디를 입력하세요"
                    >
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        비밀번호
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent transition"
                        placeholder="비밀번호를 입력하세요"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-teal-600 to-cyan-600 text-white py-3 rounded-lg font-semibold hover:from-teal-700 hover:to-cyan-700 transition duration-300 flex items-center justify-center gap-2"
                >
                    <span>로그인</span>
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                </button>
            </form>

            <!-- 회원가입 링크 -->
            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    계정이 없으신가요? 
                    <a href="/register" class="text-teal-600 font-semibold hover:text-teal-700 transition">
                        회원가입
                    </a>
                </p>
            </div>
        </div>

        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function handleLogin(event) {
    event.preventDefault();
    
    const userId = document.getElementById('userId').value.trim();
    const password = document.getElementById('password').value.trim();
    
    if (!userId || !password) {
        showAlert('아이디와 비밀번호를 모두 입력해주세요.', 'error');
        return;
    }
    
    try {
        const response = await apiCall('/users/login', 'POST', {
            id: userId,
            password: password
        });
        
        // 로그인 성공 - 사용자 정보 저장
        storage.set('user', response);
        
        // 역할에 따라 리다이렉트
        setTimeout(() => {
            if (response.role === 'PATIENT') {
                window.location.href = '/patient/home';
            } else if (response.role === 'DOCTOR' || response.role === 'CAREGIVER') {
                window.location.href = '/monitor/home';
            } else {
                window.location.href = '/patient/home';
            }
        }, 100);
        
    } catch (error) {
        showAlert(error.message || '로그인에 실패했습니다. 아이디와 비밀번호를 확인해주세요.', 'error');
    }
}
</script>
{% endblock %}
